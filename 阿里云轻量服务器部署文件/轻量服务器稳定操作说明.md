# ğŸ“š è½»é‡æœåŠ¡å™¨ç¨³å®šæ“ä½œè¯´æ˜

> æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†Shopifyå¤šè¯­è¨€ç¿»è¯‘åº”ç”¨åœ¨è½»é‡äº‘æœåŠ¡å™¨ä¸Šçš„éƒ¨ç½²å’Œè¿ç»´æ“ä½œæµç¨‹ã€‚

## ğŸ“‹ ç›®å½•

1. [æœåŠ¡å™¨åŸºç¡€ä¿¡æ¯](#1-æœåŠ¡å™¨åŸºç¡€ä¿¡æ¯)
2. [å¤šç§Ÿæˆ·æ¶æ„è¯´æ˜](#2-å¤šç§Ÿæˆ·æ¶æ„è¯´æ˜)
3. [æ—¥å¸¸æ“ä½œæµç¨‹](#3-æ—¥å¸¸æ“ä½œæµç¨‹)
4. [ç›‘æ§å’Œç»´æŠ¤](#4-ç›‘æ§å’Œç»´æŠ¤)
5. [æ•…éšœæ’æŸ¥æŒ‡å—](#5-æ•…éšœæ’æŸ¥æŒ‡å—)
6. [Shopifyè®¤è¯éƒ¨ç½²](#6-shopifyè®¤è¯éƒ¨ç½²)
7. [è‡ªåŠ¨åŒ–è„šæœ¬è¯´æ˜](#7-è‡ªåŠ¨åŒ–è„šæœ¬è¯´æ˜)
8. [æœ€ä½³å®è·µå»ºè®®](#8-æœ€ä½³å®è·µå»ºè®®)

---

## 1. æœåŠ¡å™¨åŸºç¡€ä¿¡æ¯

### 1.1 æœåŠ¡å™¨è¿æ¥ä¿¡æ¯
```bash
# æœåŠ¡å™¨IP
SERVER_IP: 47.79.77.128

# SSHå¯†é’¥ä½ç½®
SSH_KEY: /Users/elie/Downloads/shopify.pem

# ç”¨æˆ·å
USER: root

# ç»‘å®šæœ¬åœ°IPï¼ˆç»•è¿‡VPNï¼‰
BIND_IP: 192.168.31.152  # æˆ– 192.168.28.171
```

### 1.2 SSHè¿æ¥å‡½æ•°
```bash
# åŸºç¡€SSHè¿æ¥ï¼ˆç»•è¿‡VPNï¼‰
ssh_cmd() {
    ssh -b 192.168.31.152 -i /Users/elie/Downloads/shopify.pem root@47.79.77.128 "$@"
}

# SCPæ–‡ä»¶ä¼ è¾“ï¼ˆç»•è¿‡VPNï¼‰
scp_cmd() {
    scp -o BindAddress=192.168.31.152 -i /Users/elie/Downloads/shopify.pem "$@"
}
```

### 1.3 æœåŠ¡å™¨ç›®å½•ç»“æ„
```
/var/www/
â”œâ”€â”€ app1-fynony/          # Shop1åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ build/            # æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ prisma/           # æ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ prod.db       # SQLiteæ•°æ®åº“
â”‚   â”œâ”€â”€ node_modules/     # ä¾èµ–åŒ…
â”‚   â”œâ”€â”€ .env              # ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ shopify.app.toml  # Shopifyé…ç½®
â”‚
â”œâ”€â”€ app2-onewind/         # Shop2åº”ç”¨ç›®å½•
â”‚   â””â”€â”€ (åŒä¸Šç»“æ„)
â”‚
â”œâ”€â”€ lightsler-base/       # åŸºç¡€ä»£ç ç›®å½•
â””â”€â”€ ecosystem-simple.config.js  # PM2é…ç½®æ–‡ä»¶
```

---

## 2. å¤šç§Ÿæˆ·æ¶æ„è¯´æ˜

### 2.1 Shop1 - Fynonyé…ç½®
```yaml
åŸŸå: https://fynony.ease-joy.fun
ç«¯å£: 3001
å•†åº—: fynony.myshopify.com
Client ID: f97170933cde079c914f7df7e90cd806
æ•°æ®åº“: /var/www/app1-fynony/prisma/prod.db
PM2è¿›ç¨‹å: shop1-fynony
```

### 2.2 Shop2 - OneWindé…ç½®
```yaml
åŸŸå: https://onewind.ease-joy.fun
ç«¯å£: 3002
å•†åº—: onewindoutdoors.myshopify.com
Client ID: 69e94e0e69e085a95e3cc1e37e37f3ea
æ•°æ®åº“: /var/www/app2-onewind/prisma/prod.db
PM2è¿›ç¨‹å: shop2-onewind
```

### 2.3 Cloudflareéš§é“é…ç½®
```yaml
éš§é“æœåŠ¡: cloudflared
åŸŸåæ˜ å°„:
  - fynony.ease-joy.fun â†’ localhost:3001
  - onewind.ease-joy.fun â†’ localhost:3002
```

---

## 3. æ—¥å¸¸æ“ä½œæµç¨‹

### 3.1 éƒ¨ç½²æ–°ä»£ç 

#### å®Œæ•´éƒ¨ç½²æµç¨‹
```bash
# 1. åœæ­¢ç°æœ‰è¿›ç¨‹
ssh_cmd "pm2 delete all"

# 2. æ›´æ–°ä»£ç åº“ï¼ˆå‡è®¾å·²æ›´æ–°lightsler-baseï¼‰
ssh_cmd "cp -r /var/www/lightsler-base/* /var/www/app1-fynony/"
ssh_cmd "cp -r /var/www/lightsler-base/* /var/www/app2-onewind/"

# 3. æ›´æ–°é…ç½®æ–‡ä»¶
scp_cmd /path/to/shop1/.env root@47.79.77.128:/var/www/app1-fynony/.env
scp_cmd /path/to/shop2/.env root@47.79.77.128:/var/www/app2-onewind/.env

# 4. å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰
ssh_cmd "cd /var/www/app1-fynony && npm install"
ssh_cmd "cd /var/www/app2-onewind && npm install"

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
ssh_cmd "cd /var/www/app1-fynony && npx prisma migrate deploy"
ssh_cmd "cd /var/www/app2-onewind && npx prisma migrate deploy"

# 6. å¯åŠ¨åº”ç”¨
ssh_cmd "pm2 start /var/www/ecosystem-simple.config.js"
ssh_cmd "pm2 save"
```

### 3.2 å¿«é€Ÿé‡å¯åº”ç”¨
```bash
# é‡å¯æ‰€æœ‰åº”ç”¨
ssh_cmd "pm2 restart all"

# é‡å¯å•ä¸ªåº”ç”¨
ssh_cmd "pm2 restart shop1-fynony"
ssh_cmd "pm2 restart shop2-onewind"

# é‡è½½åº”ç”¨ï¼ˆé›¶åœæœºæ—¶é—´ï¼‰
ssh_cmd "pm2 reload all"
```

### 3.3 æ›´æ–°é…ç½®æ–‡ä»¶
```bash
# 1. ä¸Šä¼ æ–°çš„é…ç½®æ–‡ä»¶
scp_cmd shop1-fynony/.env root@47.79.77.128:/var/www/app1-fynony/.env
scp_cmd shop1-fynony/shopify.app.toml root@47.79.77.128:/var/www/app1-fynony/shopify.app.toml

# 2. é‡å¯åº”ç”¨ä½¿é…ç½®ç”Ÿæ•ˆ
ssh_cmd "pm2 restart shop1-fynony"
```

---

## 4. ç›‘æ§å’Œç»´æŠ¤

### 4.1 æŸ¥çœ‹åº”ç”¨çŠ¶æ€
```bash
# PM2è¿›ç¨‹çŠ¶æ€
ssh_cmd "pm2 status"

# è¯¦ç»†çŠ¶æ€ä¿¡æ¯
ssh_cmd "pm2 list"

# æŸ¥çœ‹å•ä¸ªåº”ç”¨è¯¦æƒ…
ssh_cmd "pm2 describe shop1-fynony"
```

### 4.2 æ—¥å¿—æŸ¥çœ‹
```bash
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
ssh_cmd "pm2 logs"

# æŸ¥çœ‹æŒ‡å®šåº”ç”¨æ—¥å¿—ï¼ˆæœ€è¿‘20è¡Œï¼‰
ssh_cmd "pm2 logs shop1-fynony --lines 20 --nostream"
ssh_cmd "pm2 logs shop2-onewind --lines 20 --nostream"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
ssh_cmd "tail -n 50 /var/www/app1-fynony/error.log"
ssh_cmd "tail -n 50 /var/www/app2-onewind/error.log"

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
ssh_cmd "pm2 logs shop1-fynony --lines 0"
```

### 4.3 èµ„æºç›‘æ§
```bash
# PM2ç›‘æ§é¢æ¿
ssh_cmd "pm2 monit"

# å†…å­˜ä½¿ç”¨æƒ…å†µ
ssh_cmd "pm2 list | grep -E 'shop|memory'"

# ç³»ç»Ÿèµ„æº
ssh_cmd "free -h"
ssh_cmd "df -h /var/www"
ssh_cmd "top -n 1 | head -20"

# CPUä½¿ç”¨ç‡
ssh_cmd "pm2 status | grep -E 'CPU|Memory'"
```

### 4.4 æ•°æ®åº“ç®¡ç†
```bash
# æŸ¥çœ‹æ•°æ®åº“å¤§å°
ssh_cmd "ls -lh /var/www/app1-fynony/prisma/prod.db"
ssh_cmd "ls -lh /var/www/app2-onewind/prisma/prod.db"

# å¤‡ä»½æ•°æ®åº“
ssh_cmd "cp /var/www/app1-fynony/prisma/prod.db /var/www/app1-fynony/prisma/prod.db.backup"
ssh_cmd "cp /var/www/app2-onewind/prisma/prod.db /var/www/app2-onewind/prisma/prod.db.backup"

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
ssh_cmd "cd /var/www/app1-fynony && npx prisma migrate deploy"
```

### 4.5 ç«¯å£ç›‘å¬æ£€æŸ¥
```bash
# æ£€æŸ¥åº”ç”¨ç«¯å£
ssh_cmd "netstat -tlnp | grep -E '3001|3002'"

# æ£€æŸ¥Cloudflareéš§é“
ssh_cmd "systemctl status cloudflared"
```

---

## 5. æ•…éšœæ’æŸ¥æŒ‡å—

### 5.1 åº”ç”¨æ— æ³•å¯åŠ¨

#### æ£€æŸ¥æ­¥éª¤
```bash
# 1. æŸ¥çœ‹PM2é”™è¯¯æ—¥å¿—
ssh_cmd "pm2 logs shop1-fynony --err --lines 50"

# 2. æ£€æŸ¥ç«¯å£å ç”¨
ssh_cmd "lsof -i:3001"
ssh_cmd "lsof -i:3002"

# 3. æ£€æŸ¥ç¯å¢ƒå˜é‡
ssh_cmd "cat /var/www/app1-fynony/.env | grep -E 'PORT|APP_URL'"

# 4. éªŒè¯æ•°æ®åº“è¿æ¥
ssh_cmd "cd /var/www/app1-fynony && npx prisma db push --accept-data-loss"
```

### 5.2 è®¤è¯å¾ªç¯é—®é¢˜

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. æ£€æŸ¥åº”ç”¨URLé…ç½®
ssh_cmd "grep application_url /var/www/app1-fynony/shopify.app.toml"

# 2. éªŒè¯å›è°ƒURL
ssh_cmd "grep redirect_urls /var/www/app1-fynony/shopify.app.toml"

# 3. é‡æ–°éƒ¨ç½²åˆ°Shopify
ssh_cmd "cd /var/www/app1-fynony && shopify app deploy"
```

### 5.3 å†…å­˜æº¢å‡º

#### å¤„ç†æ–¹æ³•
```bash
# 1. å¢åŠ å†…å­˜é™åˆ¶
ssh_cmd "pm2 delete shop1-fynony"
ssh_cmd "pm2 start npm --name shop1-fynony -- start --max-memory-restart 2G"

# 2. æ¸…ç†æ—¥å¿—æ–‡ä»¶
ssh_cmd "pm2 flush"

# 3. é‡å¯åº”ç”¨
ssh_cmd "pm2 restart all"
```

### 5.4 æ•°æ®åº“é”å®š

#### è§£å†³æ­¥éª¤
```bash
# 1. åœæ­¢åº”ç”¨
ssh_cmd "pm2 stop shop1-fynony"

# 2. åˆ é™¤WALæ–‡ä»¶
ssh_cmd "rm -f /var/www/app1-fynony/prisma/prod.db-wal"
ssh_cmd "rm -f /var/www/app1-fynony/prisma/prod.db-shm"

# 3. é‡å¯åº”ç”¨
ssh_cmd "pm2 start shop1-fynony"
```

---

## 6. Shopifyè®¤è¯éƒ¨ç½²

### 6.1 éƒ¨ç½²åˆ°Shopifyåå°

#### å®Œæ•´è®¤è¯æµç¨‹
```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh -b 192.168.31.152 -i /Users/elie/Downloads/shopify.pem root@47.79.77.128

# 2. è¿›å…¥åº”ç”¨ç›®å½•
cd /var/www/app1-fynony

# 3. æ‰§è¡Œéƒ¨ç½²å‘½ä»¤
shopify app deploy
```

#### è®¤è¯æ­¥éª¤
1. è®°å½•æ˜¾ç¤ºçš„éªŒè¯ç ï¼ˆå¦‚ï¼š`VNJD-ZNFD`ï¼‰
2. åœ¨æµè§ˆå™¨æ‰“å¼€è®¤è¯URLï¼š
   ```
   https://accounts.shopify.com/activate-with-code?device_code%5Buser_code%5D=éªŒè¯ç 
   ```
3. ç™»å½•Shopify Partnerè´¦å·
4. è¾“å…¥éªŒè¯ç å®Œæˆè®¤è¯
5. è¿”å›ç»ˆç«¯æŒ‰`y`ç¡®è®¤éƒ¨ç½²

### 6.2 éªŒè¯éƒ¨ç½²æˆåŠŸ
```bash
# æ£€æŸ¥Update URLsçŠ¶æ€
ssh_cmd "cd /var/www/app1-fynony && shopify app info | grep 'Update URLs'"

# åº”æ˜¾ç¤º: Update URLs  Yes
```

---

## 7. è‡ªåŠ¨åŒ–è„šæœ¬è¯´æ˜

### 7.1 deploy-simple.sh
**ç”¨é€”**: å®Œæ•´éƒ¨ç½²å¤šç§Ÿæˆ·åº”ç”¨
```bash
./deploy-simple.sh
```
- åœæ­¢ç°æœ‰è¿›ç¨‹
- åˆ›å»ºåº”ç”¨ç›®å½•
- å¤åˆ¶ä»£ç å’Œé…ç½®
- è®¾ç½®æ•°æ®åº“
- å¯åŠ¨PM2è¿›ç¨‹

### 7.2 monitor-apps.sh
**ç”¨é€”**: ç›‘æ§åº”ç”¨çŠ¶æ€
```bash
./monitor-apps.sh
```
- æ˜¾ç¤ºPM2è¿›ç¨‹çŠ¶æ€
- æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
- æ˜¾ç¤ºå†…å­˜ä½¿ç”¨
- æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
- éªŒè¯ç«¯å£ç›‘å¬

### 7.3 quick-fix-deployment.sh
**ç”¨é€”**: å¿«é€Ÿæ›´æ–°é…ç½®æ–‡ä»¶
```bash
./quick-fix-deployment.sh
```
- ä¸Šä¼ æ–°é…ç½®æ–‡ä»¶
- é‡å¯PM2è¿›ç¨‹
- æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

### 7.4 auto-deploy.sh
**ç”¨é€”**: è‡ªåŠ¨æ›´æ–°é…ç½®
```bash
./auto-deploy.sh
```
- æ£€æŸ¥å½“å‰é…ç½®
- é‡å¯åº”ç”¨

---

## 8. æœ€ä½³å®è·µå»ºè®®

### 8.1 éƒ¨ç½²å‰å‡†å¤‡
- [ ] å¤‡ä»½å½“å‰æ•°æ®åº“
- [ ] æ£€æŸ¥é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
- [ ] ç¡®è®¤åŸŸåè§£ææ­£å¸¸
- [ ] éªŒè¯SSLè¯ä¹¦æœ‰æ•ˆ

### 8.2 éƒ¨ç½²æ—¶æ³¨æ„
- [ ] ä½¿ç”¨PM2 reloadè€Œérestartï¼ˆé›¶åœæœºï¼‰
- [ ] åˆ†æ­¥éª¤éƒ¨ç½²ï¼Œå…ˆéƒ¨ç½²ä¸€ä¸ªåº”ç”¨æµ‹è¯•
- [ ] ä¿ç•™æ—§ç‰ˆæœ¬ä»£ç å¤‡ä»½
- [ ] è®°å½•éƒ¨ç½²æ—¶é—´å’Œç‰ˆæœ¬

### 8.3 éƒ¨ç½²åéªŒè¯
- [ ] æ£€æŸ¥æ‰€æœ‰è¿›ç¨‹æ­£å¸¸è¿è¡Œ
- [ ] éªŒè¯åº”ç”¨å¯ä»¥è®¿é—®
- [ ] æµ‹è¯•OAuthè®¤è¯æµç¨‹
- [ ] æ£€æŸ¥Webhookæ³¨å†ŒçŠ¶æ€
- [ ] ç›‘æ§é”™è¯¯æ—¥å¿—15åˆ†é’Ÿ

### 8.4 æ—¥å¸¸ç»´æŠ¤
- æ¯æ—¥æ£€æŸ¥PM2çŠ¶æ€
- æ¯å‘¨å¤‡ä»½æ•°æ®åº“
- å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶
- ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨
- åŠæ—¶æ›´æ–°å®‰å…¨è¡¥ä¸

### 8.5 åº”æ€¥é¢„æ¡ˆ
1. **ä¿æŒå¤‡ä»½è„šæœ¬**
   ```bash
   # æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
   0 2 * * * /root/backup-apps.sh
   ```

2. **å¿«é€Ÿå›æ»šæ–¹æ¡ˆ**
   ```bash
   # ä¿ç•™ä¸Šä¸ªç‰ˆæœ¬
   cp -r /var/www/app1-fynony /var/www/app1-fynony.backup
   ```

3. **ç´§æ€¥è”ç³»æ–¹å¼**
   - Shopify Partner Support
   - Cloudflare Support
   - æœåŠ¡å™¨è¿ç»´å›¢é˜Ÿ

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# å¿«é€ŸSSHè¿æ¥
alias ssh_shop='ssh -b 192.168.31.152 -i /Users/elie/Downloads/shopify.pem root@47.79.77.128'

# æŸ¥çœ‹çŠ¶æ€
ssh_shop "pm2 status"

# æŸ¥çœ‹æ—¥å¿—
ssh_shop "pm2 logs --lines 20"

# é‡å¯åº”ç”¨
ssh_shop "pm2 restart all"

# ç›‘æ§èµ„æº
ssh_shop "pm2 monit"

# æ•°æ®åº“å¤‡ä»½
ssh_shop "cp /var/www/app1-fynony/prisma/prod.db /backup/shop1-$(date +%Y%m%d).db"
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **å®šæœŸæ›´æ–°SSHå¯†é’¥**
2. **ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤æ•°æ®åº“**
3. **é™åˆ¶æœåŠ¡å™¨è®¿é—®IP**
4. **å¯ç”¨é˜²ç«å¢™è§„åˆ™**
5. **å®šæœŸå®¡è®¡æ—¥å¿—**
6. **ä¿æŒè½¯ä»¶æ›´æ–°**
7. **ä½¿ç”¨HTTPSåŠ å¯†**
8. **å®šæœŸå¤‡ä»½æ•°æ®**

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **é¡¹ç›®æ–‡æ¡£**: `/Users/elie/Downloads/translate/Lightsler-Ai/CLAUDE.md`
- **éƒ¨ç½²è„šæœ¬**: `/Users/elie/Downloads/*.sh`
- **é…ç½®æ–‡ä»¶**: `/Users/elie/Downloads/shop*/`
- **é—®é¢˜åé¦ˆ**: åˆ›å»ºGitHub Issue

---

*æœ€åæ›´æ–°: 2025å¹´9æœˆ21æ—¥*