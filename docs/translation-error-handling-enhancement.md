# ç¿»è¯‘ç³»ç»Ÿå…³é”®èŠ‚ç‚¹æœ¬åœ°åŒ–é”™è¯¯å¤„ç†å¢å¼º - éœ€æ±‚æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-10-01
- **æœ€åæ›´æ–°**: 2025-10-01
- **çŠ¶æ€**: å¾…å®æ–½
- **ä¼˜å…ˆçº§**: P2 (ä¸­ç­‰)
- **é¢„è®¡å·¥ä½œé‡**: 1-1.5å°æ—¶

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åœ¨ç¿»è¯‘ç³»ç»Ÿçš„å…³é”®èŠ‚ç‚¹ï¼ˆé•¿æ–‡æœ¬åˆ†å—ã€URLè½¬æ¢ï¼‰å¢åŠ æœ¬åœ°åŒ–é”™è¯¯å¤„ç†ï¼Œé€šè¿‡ä¸­æ–‡é”™è¯¯æ¶ˆæ¯ã€è¯¦ç»†ä¸Šä¸‹æ–‡å’Œé”™è¯¯ç æ ‡è¯†ï¼Œæå‡é—®é¢˜å®šä½æ•ˆç‡å’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸš€ æå‡å¼€å‘æ•ˆç‡ï¼šä»"æœç´¢æ—¥å¿—â†’ç†è§£å«ä¹‰â†’å®šä½ä»£ç "ç¼©çŸ­åˆ°"é”™è¯¯ç ç›´è¾¾"
- ğŸ” å¢å¼ºå¯è§‚æµ‹æ€§ï¼šç³»ç»Ÿæ€§æ”¶é›†å¼‚å¸¸æ•°æ®ï¼Œæ”¯æŒè¶‹åŠ¿åˆ†æ
- ğŸ›¡ï¸ é™ä½ç»´æŠ¤æˆæœ¬ï¼šæœ¬åœ°åŒ–æ¶ˆæ¯é™ä½ç†è§£é—¨æ§›ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### å­˜åœ¨çš„é—®é¢˜

1. **é”™è¯¯æ¶ˆæ¯éæœ¬åœ°åŒ–**
   - è‹±æ–‡é”™è¯¯æ¶ˆæ¯ï¼Œéœ€è¦é¢å¤–ç†è§£æˆæœ¬
   - ç¼ºå°‘ä¿®å¤å»ºè®®ï¼Œå¢åŠ æ’æŸ¥éš¾åº¦

2. **ç¼ºå°‘ç³»ç»Ÿæ€§é”™è¯¯æ”¶é›†**
   - å…³é”®èŠ‚ç‚¹ï¼ˆåˆ†å—ã€URLè½¬æ¢ï¼‰æ— å¼‚å¸¸ç›‘æ§
   - éš¾ä»¥å‘ç°ç³»ç»Ÿæ€§é—®é¢˜å’Œä¼˜åŒ–æœºä¼š

3. **é—®é¢˜å®šä½æ•ˆç‡ä½**
   - æ— é”™è¯¯ç æ ‡è¯†ï¼Œéœ€è¦æœç´¢ä»£ç 
   - ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸å®Œæ•´ï¼Œéš¾ä»¥é‡ç°é—®é¢˜

### ç°æœ‰åŸºç¡€

- âœ… **é”™è¯¯æ”¶é›†ç³»ç»Ÿ**ï¼š`ErrorCollectorService` å·²å®ç°
- âœ… **é”™è¯¯åˆ†ç±»**ï¼š10ç§é”™è¯¯ç±»å‹ï¼Œ4ç§åˆ†ç±»çº§åˆ«
- âœ… **é”™è¯¯æŒ‡çº¹**ï¼šå»é‡å’Œåˆ†ç»„æœºåˆ¶å®Œå–„
- âœ… **æœ¬åœ°åŒ–æ¡†æ¶**ï¼š`error-messages.server.js` å·²å­˜åœ¨
- âš ï¸ **è¦†ç›–ä¸è¶³**ï¼šé•¿æ–‡æœ¬ç¿»è¯‘å’ŒURLè½¬æ¢ç›‘æ§ç¼ºå¤±

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### éœ€æ±‚1ï¼šæœ¬åœ°åŒ–é”™è¯¯æ¶ˆæ¯ç³»ç»Ÿå¢å¼º

**ç›®æ ‡**ï¼šæ‰©å±•ç°æœ‰é”™è¯¯æ¶ˆæ¯ç³»ç»Ÿï¼Œæ”¯æŒå‚æ•°åŒ–æ¶ˆæ¯

**ç°æœ‰èƒ½åŠ›**ï¼š
```javascript
// app/utils/error-messages.server.js
export function getLocalizedErrorMessage(code, locale = DEFAULT_LOCALE, fallback = '')
```

**éœ€æ±‚æ”¹è¿›**ï¼š
```javascript
// æ”¯æŒå‚æ•°æ›¿æ¢
getLocalizedErrorMessage('CHUNK_SIZE_ABNORMAL', 'zh-CN', {
  chunks: 150,
  textLength: 12000
})
// è¿”å›: "åˆ†å—æ•°é‡å¼‚å¸¸(150ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡"
```

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… ç®€å•æ›¿æ¢ï¼šä½¿ç”¨ `replace()` å¾ªç¯ï¼Œæ— é¢å¤–ä¾èµ–
- âœ… å®¹é”™å¤„ç†ï¼šæœªæä¾›çš„ `{param}` ä¿ç•™åŸæ ·ï¼Œæ–¹ä¾¿è°ƒè¯•
- âœ… æ— ç‰¹æ®Šå¤„ç†ï¼šä¸è½¬ä¹‰ `$1` ç­‰ç‰¹æ®Šå­—ç¬¦
- âœ… ä¿æŒç®€æ´ï¼šåªå­˜å‚¨æ¶ˆæ¯æ˜ å°„ï¼Œseverity/code åœ¨è°ƒç”¨æ—¶æŒ‡å®š

**æ–°å¢é”™è¯¯æ¶ˆæ¯**ï¼š
| é”™è¯¯ç  | ä¸­æ–‡æ¶ˆæ¯ | å‚æ•° |
|--------|----------|------|
| CHUNK_SIZE_ABNORMAL | åˆ†å—æ•°é‡å¼‚å¸¸({chunks}ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡ | chunks, textLength |
| LINK_CONVERSION_LOW_SUCCESS_RATE | URLè½¬æ¢æˆåŠŸç‡è¿‡ä½ | rate, total, failed |

---

### éœ€æ±‚2ï¼šé•¿æ–‡æœ¬åˆ†å—å¼‚å¸¸ç›‘æ§

**ä¸šåŠ¡åœºæ™¯**ï¼š
æ™ºèƒ½åˆ†å—å‡½æ•° (`intelligentChunkText`) å°†é•¿æ–‡æœ¬åˆ†å‰²ä¸ºå¤šä¸ªå—è¿›è¡Œç¿»è¯‘ã€‚è¿‡åº¦åˆ†å—å¯èƒ½å¯¼è‡´ï¼š
- ç¿»è¯‘è´¨é‡ä¸‹é™ï¼ˆä¸Šä¸‹æ–‡ä¸¢å¤±ï¼‰
- APIè°ƒç”¨æ¬¡æ•°å¢åŠ 
- ç¿»è¯‘æ—¶é—´å»¶é•¿

**ç›‘æ§ç›®æ ‡**ï¼š
å‘ç°å¼‚å¸¸åˆ†å—è¡Œä¸ºï¼Œä¸ºç®—æ³•ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒ

**è§¦å‘æ¡ä»¶**ï¼š
```javascript
chunks.length > 100  // å•ä¸€æ¡ä»¶ï¼Œä¿æŒç®€å•
```

**ç›‘æ§ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`app/services/translation/core.server.js`
- å‡½æ•°ï¼š`intelligentChunkText`
- ä½ç½®ï¼šå‡½æ•°æœ«å°¾ï¼ˆreturn å‰ï¼‰

**æ”¶é›†ä¿¡æ¯**ï¼š
```javascript
{
  errorCode: 'CHUNK_SIZE_ABNORMAL',
  errorType: ERROR_TYPES.TRANSLATION,
  errorCategory: 'WARNING',
  message: "åˆ†å—æ•°é‡å¼‚å¸¸(150ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡",
  severity: 2,
  operation: 'intelligentChunkText',
  context: {
    chunkCount: 150,           // åˆ†å—æ•°é‡
    textLength: 12000,         // åŸæ–‡é•¿åº¦
    averageSize: 80,           // å¹³å‡å—å¤§å°
    isHtml: true               // æ˜¯å¦HTMLå†…å®¹
  }
}
```

**å®æ–½æ–¹å¼**ï¼š
1. æ—¥å¿—è®°å½•ï¼š`logger.warn()` - ç«‹å³å¯è§
2. é”™è¯¯æ”¶é›†ï¼š`collectError()` - æŒä¹…åŒ–åˆ†æ

**ä»·å€¼è¯„ä¼°**ï¼š
- âœ… å‘ç°è¿‡åº¦åˆ†å—çš„æ–‡æœ¬ç‰¹å¾
- âœ… ä¸ºåˆ†å—ç®—æ³•ä¼˜åŒ–æä¾›æ•°æ®
- âœ… ç›‘æ§ç³»ç»Ÿæ•´ä½“å¥åº·åº¦

---

### éœ€æ±‚3ï¼šURLè½¬æ¢æˆåŠŸç‡ç›‘æ§

**ä¸šåŠ¡åœºæ™¯**ï¼š
é“¾æ¥è½¬æ¢åŠŸèƒ½å°†å†…é“¾è½¬æ¢ä¸ºå¤šè¯­è¨€URLï¼ˆå¦‚ `/products/test` â†’ `/pt/products/test`ï¼‰ã€‚è½¬æ¢å¤±è´¥å¯èƒ½å¯¼è‡´ï¼š
- å¤šè¯­è¨€ç«™ç‚¹å†…é“¾æŒ‡å‘é”™è¯¯è¯­è¨€
- ç”¨æˆ·ä½“éªŒå—æŸï¼ˆè¯­è¨€åˆ‡æ¢åé“¾æ¥å¤±æ•ˆï¼‰
- SEOå½±å“ï¼ˆé”™è¯¯çš„è¯­è¨€é“¾æ¥ï¼‰

**ç›‘æ§ç›®æ ‡**ï¼š
åŠæ—¶å‘ç°Marketsé…ç½®ç¼ºå¤±æˆ–URLè½¬æ¢å¼‚å¸¸

**è§¦å‘æ¡ä»¶**ï¼š
```javascript
successRate < 80% && totalLinks >= 5
```

**ç›‘æ§ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`app/services/link-converter.server.js`
- å‡½æ•°ï¼š`convertLinksForLocale`
- ä½ç½®ï¼šå‡½æ•°æœ«å°¾ï¼ˆè½¬æ¢å®Œæˆåï¼‰

**æ•°æ®æ”¶é›†æµç¨‹**ï¼š
```javascript
// 1. è½¬æ¢è¿‡ç¨‹ä¸­ç»Ÿè®¡
const stats = {
  totalLinks: 0,
  successCount: 0,
  failedCount: 0,
  failedUrls: []  // æœ€å¤šæ”¶é›†3æ¡
};

// 2. å•ä¸ªé“¾æ¥è½¬æ¢å¤±è´¥æ—¶
if (stats.failedUrls.length < 3) {
  stats.failedUrls.push({
    url: url.substring(0, 200),           // æˆªæ–­è‡³200å­—ç¬¦
    error: error.message.substring(0, 100) // æˆªæ–­è‡³100å­—ç¬¦
  });
}

// 3. è½¬æ¢å®Œæˆåæ£€æŸ¥æˆåŠŸç‡
if (successRate < 80 && totalLinks >= 5) {
  collectError({...});
}
```

**æ”¶é›†ä¿¡æ¯**ï¼š
```javascript
{
  errorCode: 'LINK_CONVERSION_LOW_SUCCESS_RATE',
  errorType: ERROR_TYPES.TRANSLATION,
  errorCategory: 'WARNING',
  message: "URLè½¬æ¢æˆåŠŸç‡è¿‡ä½",
  severity: 2,
  operation: 'convertLinksForLocale',
  context: {
    targetLocale: 'pt',
    stats: {
      total: 12,
      success: 8,
      failed: 4,
      rate: "66.7"
    },
    failedSamples: [  // æœ€å¤š3æ¡
      {
        url: "/products/test-product-with-very...",
        error: "Target config missing for locale"
      },
      {
        url: "http://example.com/page...",
        error: "Invalid URL format"
      }
    ]
  }
}
```

**å®æ–½æ–¹å¼**ï¼š
1. ç»Ÿè®¡é€»è¾‘ï¼šéå†è¿‡ç¨‹ä¸­ç´¯è®¡æˆåŠŸ/å¤±è´¥
2. æ ·æœ¬æ”¶é›†ï¼šæœ€å¤š3æ¡å¤±è´¥æ ·æœ¬ï¼ˆURL+errorå‡æˆªæ–­ï¼‰
3. æ—¥å¿—è®°å½•ï¼š`logger.warn()` - å®Œæ•´ä¿¡æ¯
4. é”™è¯¯æ”¶é›†ï¼š`collectError()` - æˆªæ–­åä¿¡æ¯

**ä»·å€¼è¯„ä¼°**ï¼š
- âœ… å¿«é€Ÿå‘ç°Marketsé…ç½®é—®é¢˜
- âœ… è¯†åˆ«éœ€è¦ç‰¹æ®Šå¤„ç†çš„URLæ¨¡å¼
- âœ… ç›‘æ§é“¾æ¥è½¬æ¢åŠŸèƒ½å¥åº·åº¦

---

### éœ€æ±‚4ï¼šé”™è¯¯æŸ¥è¯¢æ–‡æ¡£

**ç›®æ ‡**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯æŸ¥è¯¢æŒ‡å—ï¼Œé™ä½æ’æŸ¥é—¨æ§›

**æ–‡æ¡£ä½ç½®**ï¼š`CLAUDE.md` - æ•…éšœæ’æŸ¥ç« èŠ‚

**å†…å®¹è¦ç‚¹**ï¼š

#### APIæŸ¥è¯¢æ–¹å¼
```bash
# æŸ¥è¯¢æ‰€æœ‰ç¿»è¯‘ç›¸å…³é”™è¯¯
GET /api/errors?isTranslationError=true&limit=50

# æŸ¥è¯¢ç‰¹å®šé”™è¯¯ç 
GET /api/errors?errorCode=CHUNK_SIZE_ABNORMAL
GET /api/errors?errorCode=LINK_CONVERSION_LOW_SUCCESS_RATE

# ç»„åˆæŸ¥è¯¢
GET /api/errors?isTranslationError=true&severity=3
```

#### æœ¬åœ°æ—¥å¿—æŸ¥è¯¢
```bash
# å®æ—¶æŸ¥çœ‹ç¿»è¯‘é”™è¯¯
tail -f logs/app.log | jq 'select(.errorCode != null)'

# ç»Ÿè®¡é”™è¯¯é¢‘ç‡
tail -1000 logs/app.log | jq -r '.errorCode' | grep -v null | sort | uniq -c | sort -rn

# æŸ¥çœ‹ç‰¹å®šé”™è¯¯è¯¦æƒ…
tail -f logs/app.log | jq 'select(.errorCode == "CHUNK_SIZE_ABNORMAL")'
```

#### å¸¸è§é”™è¯¯ç è¯´æ˜
| é”™è¯¯ç  | å«ä¹‰ | æ’æŸ¥å»ºè®® |
|--------|------|----------|
| CHUNK_SIZE_ABNORMAL | åˆ†å—æ•°é‡è¿‡å¤š | æ£€æŸ¥åŸæ–‡æ ¼å¼ï¼Œæ˜¯å¦åŒ…å«å¼‚å¸¸HTMLç»“æ„ |
| LINK_CONVERSION_LOW_SUCCESS_RATE | URLè½¬æ¢æˆåŠŸç‡ä½ | æ£€æŸ¥Marketsé…ç½®ï¼Œç¡®è®¤ç›®æ ‡è¯­è¨€åŸŸåæ˜ å°„ |

**ä»·å€¼**ï¼š
- âœ… å¼€å‘è€…è‡ªåŠ©æ’æŸ¥
- âœ… å‡å°‘æ²Ÿé€šæˆæœ¬
- âœ… ç»Ÿä¸€æ’æŸ¥æµç¨‹

---

## ğŸ“ æŠ€æœ¯è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **KISSåŸåˆ™**
   - æœ€å°åŒ–æ”¹åŠ¨ï¼šåªåœ¨å…³é”®èŠ‚ç‚¹å¢åŠ ç›‘æ§
   - æ¸è¿›éªŒè¯ï¼šPhase 0å…ˆéªŒè¯ï¼Œè§‚å¯Ÿåå†æ‰©å±•
   - å¤ç”¨ç°æœ‰ï¼šåŸºäºå·²æœ‰ErrorCollectorå’Œerror-messages

2. **éä¾µå…¥æ€§**
   - ä¸æ”¹å˜ç°æœ‰ç¿»è¯‘é€»è¾‘
   - é”™è¯¯æ”¶é›†å¯¹ç”¨æˆ·é€æ˜
   - æ€§èƒ½å½±å“å¯å¿½ç•¥ï¼ˆä»…å¼‚å¸¸æ—¶è§¦å‘ï¼‰

3. **å¯è§‚æµ‹ä¼˜å…ˆ**
   - æ—¥å¿—ä¼˜å…ˆï¼šç«‹å³å¯è§ï¼Œå®æ—¶è°ƒè¯•
   - æŒ‰éœ€æŒä¹…åŒ–ï¼šé¿å…æ•°æ®è†¨èƒ€
   - ä¿ç•™ä¸Šä¸‹æ–‡ï¼šè¶³å¤Ÿé‡ç°é—®é¢˜

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç¿»è¯‘æ“ä½œï¼ˆæ­£å¸¸æµç¨‹ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€ intelligentChunkText
             â”‚   â””â”€â”€ chunks.length > 100?
             â”‚       â”œâ”€â”€ Yes â†’ logger.warn + collectError
             â”‚       â””â”€â”€ No â†’ ç»§ç»­
             â”‚
             â”œâ”€â”€ convertLinksForLocale
             â”‚   â””â”€â”€ successRate < 80% && totalLinks >= 5?
             â”‚       â”œâ”€â”€ Yes â†’ logger.warn + collectError
             â”‚       â””â”€â”€ No â†’ ç»§ç»­
             â”‚
             â””â”€â”€ è¿”å›ç¿»è¯‘ç»“æœï¼ˆä¸å—å½±å“ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é”™è¯¯æ”¶é›†ä¸æŸ¥è¯¢                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€ logger.warn() â†’ logs/app.logï¼ˆå®æ—¶ï¼‰
             â”‚
             â”œâ”€â”€ collectError() â†’ ErrorLogè¡¨ï¼ˆæŒä¹…åŒ–ï¼‰
             â”‚   â””â”€â”€ åŒ…å«: errorCode, message, context
             â”‚
             â””â”€â”€ æŸ¥è¯¢æ–¹å¼
                 â”œâ”€â”€ /api/errors?errorCode=xxx
                 â””â”€â”€ tail -f logs/app.log | jq '...'
```

### æ•°æ®æµ

```
è§¦å‘ç‚¹ï¼ˆå¦‚ chunks > 100ï¼‰
    â†“
1. getLocalizedErrorMessage()  // ç”Ÿæˆä¸­æ–‡æ¶ˆæ¯
    â†“
2. logger.warn()               // ç«‹å³å†™å…¥æ—¥å¿—
    â†“
3. collectError()              // å¼‚æ­¥å†™å…¥æ•°æ®åº“
    â†“
4. ErrorLogè¡¨                  // æŒä¹…åŒ–å­˜å‚¨
    â†“
5. æŸ¥è¯¢/åˆ†æ                   // å¼€å‘è€…æ’æŸ¥
```

### é”™è¯¯åˆ†ç±»

```javascript
{
  errorType: 'TRANSLATION',       // æ‰€æœ‰ç¿»è¯‘ç›¸å…³
  errorCategory: 'WARNING',       // ä¸å½±å“åŠŸèƒ½
  severity: 2,                    // ä¸­ç­‰ä¸¥é‡åº¦
  isTranslationError: true,       // ç”¨äºç­›é€‰
  operation: 'å…·ä½“æ“ä½œå‡½æ•°å'      // å¿«é€Ÿå®šä½
}
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 0ï¼šæœ€å°éªŒè¯ï¼ˆ1-1.5å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šåœ¨2ä¸ªé«˜ä»·å€¼åœºæ™¯æ‰“ç‚¹ï¼ŒéªŒè¯æ•ˆæœ

#### ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | æ”¹åŠ¨ç‚¹ | è¡Œæ•° | è¯´æ˜ |
|------|--------|------|------|
| `app/utils/error-messages.server.js` | æ·»åŠ 2ä¸ªé”™è¯¯æ¶ˆæ¯ + æ‰©å±•å‡½æ•° | ~15è¡Œ | æ”¯æŒå‚æ•°æ›¿æ¢ |
| `app/services/translation/core.server.js` | `intelligentChunkText` æœ«å°¾ | ~15è¡Œ | åˆ†å—å¼‚å¸¸ç›‘æ§ |
| `app/services/link-converter.server.js` | `convertLinksForLocale` ç»Ÿè®¡+å‘Šè­¦ | ~35è¡Œ | URLè½¬æ¢ç›‘æ§ |
| `CLAUDE.md` | æ·»åŠ é”™è¯¯æ’æŸ¥ç« èŠ‚ | ~25è¡Œ | æ–‡æ¡£æ›´æ–° |

**æ€»ä»£ç é‡**ï¼š~90è¡Œï¼ˆçº¯å¢é‡ï¼‰

#### å®æ–½æ­¥éª¤

1. **æ‰©å±• error-messages.server.js**ï¼ˆ15åˆ†é’Ÿï¼‰
   ```javascript
   // 1. æ·»åŠ 2ä¸ªé”™è¯¯æ¶ˆæ¯åˆ° ERROR_MESSAGES
   // 2. æ‰©å±• getLocalizedErrorMessage æ”¯æŒ params å‚æ•°
   // 3. æ·»åŠ å‚æ•°æ›¿æ¢é€»è¾‘ï¼ˆç®€å• replace å¾ªç¯ï¼‰
   ```

2. **æ·»åŠ åˆ†å—å¼‚å¸¸ç›‘æ§**ï¼ˆ20åˆ†é’Ÿï¼‰
   ```javascript
   // åœ¨ intelligentChunkText å‡½æ•°æœ«å°¾
   if (chunks.length > 100) {
     const message = getLocalizedErrorMessage('CHUNK_SIZE_ABNORMAL', 'zh-CN', {...});
     logger.warn(message, {...});
     collectError({...});
   }
   ```

3. **æ·»åŠ URLè½¬æ¢ç›‘æ§**ï¼ˆ30åˆ†é’Ÿï¼‰
   ```javascript
   // åœ¨ convertLinksForLocale ä¸­
   // 1. åˆå§‹åŒ– stats ç»Ÿè®¡å¯¹è±¡
   // 2. è½¬æ¢å¤±è´¥æ—¶æ”¶é›†æ ·æœ¬ï¼ˆæœ€å¤š3æ¡ï¼‰
   // 3. è½¬æ¢å®Œæˆåæ£€æŸ¥æˆåŠŸç‡
   // 4. æˆåŠŸç‡ä½æ—¶ logger + collectError
   ```

4. **æ›´æ–°æ–‡æ¡£**ï¼ˆ15åˆ†é’Ÿï¼‰
   ```markdown
   // åœ¨ CLAUDE.md æ·»åŠ "ç¿»è¯‘é”™è¯¯æ’æŸ¥"ç« èŠ‚
   // åŒ…æ‹¬ï¼šAPIæŸ¥è¯¢ã€æ—¥å¿—æŸ¥è¯¢ã€é”™è¯¯ç è¯´æ˜
   ```

#### éªŒè¯æ–¹å¼

```bash
# 1. ä»£ç æ£€æŸ¥
npm run check:lint   # ESLinté€šè¿‡
npm run check:build  # æ„å»ºæˆåŠŸ

# 2. ä¸å¯åŠ¨é¡¹ç›®
# ç­‰å¾…ç”Ÿäº§ç¯å¢ƒè‡ªç„¶è§¦å‘ï¼Œæˆ–ä½¿ç”¨ç°æœ‰æµ‹è¯•æ•°æ®

# 3. å¦‚å¿…é¡»éªŒè¯è¿è¡Œæ—¶
shopify app dev --tunnel-url=https://translate.ease-joy.fun:3000
# ç¿»è¯‘åŒ…å«é•¿æ–‡æœ¬çš„èµ„æºï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡º
```

#### éªŒæ”¶æ ‡å‡†

- [ ] `npm run check:lint` é€šè¿‡
- [ ] `npm run check:build` é€šè¿‡
- [ ] é”™è¯¯æ¶ˆæ¯æ”¯æŒå‚æ•°æ›¿æ¢
- [ ] åˆ†å— > 100 æ—¶æ­£ç¡®è®°å½•é”™è¯¯
- [ ] URLæˆåŠŸç‡ < 80% æ—¶æ­£ç¡®è®°å½•é”™è¯¯
- [ ] CLAUDE.md åŒ…å«é”™è¯¯æŸ¥è¯¢æ–‡æ¡£

---

### è§‚å¯ŸæœŸï¼ˆ1-2å‘¨ï¼‰

**è§‚å¯Ÿå†…å®¹**ï¼š

1. **è§¦å‘é¢‘ç‡**
   ```bash
   # æŸ¥è¯¢åˆ†å—å¼‚å¸¸é¢‘ç‡
   curl "/api/errors?errorCode=CHUNK_SIZE_ABNORMAL&limit=100" | jq '.total'

   # æŸ¥è¯¢URLè½¬æ¢å‘Šè­¦é¢‘ç‡
   curl "/api/errors?errorCode=LINK_CONVERSION_LOW_SUCCESS_RATE&limit=100" | jq '.total'
   ```

2. **æ•°æ®è´¨é‡**
   - é”™è¯¯ä¸Šä¸‹æ–‡æ˜¯å¦è¶³å¤Ÿå®šä½é—®é¢˜ï¼Ÿ
   - æ˜¯å¦æœ‰è¯¯æŠ¥ï¼ˆæ­£å¸¸æƒ…å†µè¢«å‘Šè­¦ï¼‰ï¼Ÿ
   - é˜ˆå€¼è®¾ç½®æ˜¯å¦åˆç†ï¼Ÿ

3. **å®é™…ä»·å€¼**
   - æ˜¯å¦çœŸæ­£å¸®åŠ©å‘ç°å’Œè§£å†³äº†é—®é¢˜ï¼Ÿ
   - å¼€å‘è€…æ˜¯å¦ä½¿ç”¨äº†é”™è¯¯æŸ¥è¯¢åŠŸèƒ½ï¼Ÿ
   - æ˜¯å¦æœ‰æ–°çš„ç›‘æ§éœ€æ±‚ï¼Ÿ

**æ•°æ®æ”¶é›†**ï¼š
```bash
# ç»Ÿè®¡é”™è¯¯åˆ†å¸ƒ
tail -7d logs/app.log | \
  jq -r '.errorCode' | \
  grep -v null | \
  sort | uniq -c | sort -rn

# æŸ¥çœ‹å…·ä½“é”™è¯¯è¯¦æƒ…
jq 'select(.errorCode == "CHUNK_SIZE_ABNORMAL")' logs/app.log | \
  jq -s 'group_by(.context.chunkCount) | map({count: .[0].context.chunkCount, occurrences: length})'
```

**è¯„ä¼°æ ‡å‡†**ï¼š
- âœ… é¢‘ç‡åˆç†ï¼ˆ5-20æ¬¡/å‘¨ï¼Œä¸è¿‡å¤šä¸è¿‡å°‘ï¼‰
- âœ… æœ‰æ•ˆå®šä½ï¼ˆè‡³å°‘å‘ç°1ä¸ªå®é™…é—®é¢˜ï¼‰
- âœ… æ— è¯¯æŠ¥ï¼ˆè¯¯æŠ¥ç‡ < 10%ï¼‰

---

### Phase 1ï¼šæŒ‰éœ€æ‰©å±•ï¼ˆå¾…å®šï¼‰

æ ¹æ®è§‚å¯ŸæœŸæ•°æ®å†³å®šæ˜¯å¦éœ€è¦ï¼š

#### å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘

1. **é˜ˆå€¼è°ƒä¼˜**
   - åˆ†å—æ•°é‡ï¼šä»100è°ƒæ•´åˆ°50æˆ–150
   - URLæˆåŠŸç‡ï¼šä»80%è°ƒæ•´åˆ°70%æˆ–90%
   - åŠ¨æ€é˜ˆå€¼ï¼šæ ¹æ®æ–‡æœ¬ç±»å‹è°ƒæ•´

2. **æ–°å¢åœºæ™¯**
   - ç¿»è¯‘éªŒè¯å¤±è´¥ï¼ˆcompleteness checkï¼‰
   - APIè¶…æ—¶é¢‘ç¹
   - é˜Ÿåˆ—å¤„ç†å¼‚å¸¸

3. **åŠŸèƒ½å¢å¼º**
   - ä¸“é—¨çš„é”™è¯¯æŸ¥è¯¢API
   - ç›‘æ§ä»ªè¡¨ç›˜é›†æˆ
   - é”™è¯¯è¶‹åŠ¿åˆ†æ
   - è‡ªåŠ¨å‘Šè­¦é€šçŸ¥

4. **æ•°æ®ä¼˜åŒ–**
   - é”™è¯¯èšåˆç»Ÿè®¡
   - æ ¹å› è‡ªåŠ¨åˆ†æ
   - ä¿®å¤å»ºè®®æ™ºèƒ½æ¨è

#### å†³ç­–ä¾æ®

| æŒ‡æ ‡ | æ‰©å±•é˜ˆå€¼ | è¯´æ˜ |
|------|----------|------|
| é”™è¯¯é¢‘ç‡ | > 10æ¬¡/å‘¨ | è¶³å¤Ÿæ ·æœ¬é‡ |
| å®šä½ä»·å€¼ | â‰¥ 1ä¸ªé—®é¢˜/æœˆ | çœŸæ­£æœ‰ç”¨ |
| è¯¯æŠ¥ç‡ | < 10% | ä¿¡å·æ¸…æ™° |
| å¼€å‘éœ€æ±‚ | â‰¥ 2äººæå‡º | çœŸå®éœ€æ±‚ |

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] **å‚æ•°æ›¿æ¢åŠŸèƒ½**
  - `getLocalizedErrorMessage` æ”¯æŒ `{param}` æ›¿æ¢
  - æœªæä¾›å‚æ•°ä¿ç•™åŸæ ·
  - æ— ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰é—®é¢˜

- [ ] **åˆ†å—å¼‚å¸¸ç›‘æ§**
  - åˆ†å—æ•° > 100 æ—¶è§¦å‘
  - é”™è¯¯æ¶ˆæ¯ä¸ºä¸­æ–‡
  - context åŒ…å«å®Œæ•´ä¿¡æ¯ï¼ˆchunkCount, textLength, averageSizeï¼‰

- [ ] **URLè½¬æ¢ç›‘æ§**
  - æˆåŠŸç‡ < 80% ä¸”é“¾æ¥æ•° â‰¥ 5 æ—¶è§¦å‘
  - æ”¶é›†æœ€å¤š3æ¡å¤±è´¥æ ·æœ¬
  - URLå’Œerrorå‡æ­£ç¡®æˆªæ–­

- [ ] **é”™è¯¯æŸ¥è¯¢**
  - å¯é€šè¿‡ `/api/errors?errorCode=xxx` æŸ¥è¯¢
  - å¯é€šè¿‡ jq è¿‡æ»¤æ—¥å¿—
  - æ–‡æ¡£ç¤ºä¾‹å¯æ­£å¸¸è¿è¡Œ

### è´¨é‡éªŒæ”¶

- [ ] **ä»£ç è´¨é‡**
  - `npm run check:lint` æ— æ–°å¢é”™è¯¯
  - `npm run check:build` æˆåŠŸ
  - ä»£ç ç¬¦åˆç°æœ‰é£æ ¼

- [ ] **æ€§èƒ½å½±å“**
  - æ­£å¸¸æµç¨‹æ— æ€§èƒ½ä¸‹é™
  - é”™è¯¯æ”¶é›†ä¸é˜»å¡ä¸»æµç¨‹
  - æ•°æ®åº“æ— æ€§èƒ½é—®é¢˜

- [ ] **å…¼å®¹æ€§**
  - ä¸å½±å“ç°æœ‰ç¿»è¯‘åŠŸèƒ½
  - å‘åå…¼å®¹ï¼ˆ`getLocalizedErrorMessage` ä¸ä¼  params ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼‰

### æ–‡æ¡£éªŒæ”¶

- [ ] **éœ€æ±‚æ–‡æ¡£**
  - æœ¬æ–‡æ¡£å®Œæ•´æ¸…æ™°
  - åŒ…å«æ‰€æœ‰è®¾è®¡ç»†èŠ‚

- [ ] **ç”¨æˆ·æ–‡æ¡£**
  - CLAUDE.md åŒ…å«é”™è¯¯æ’æŸ¥ç« èŠ‚
  - ç¤ºä¾‹ä»£ç å¯è¿è¡Œ
  - é”™è¯¯ç è¯´æ˜æ¸…æ™°

- [ ] **TODO.mdæ›´æ–°**
  - ä»»åŠ¡æ·»åŠ åˆ°è¿›è¡Œä¸­
  - åŒ…å«Phase 0æ£€æŸ¥æ¸…å•
  - æ ‡æ³¨è§‚å¯ŸæœŸæ—¶é—´

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### å¼€å‘ä½“éªŒæ”¹è¿›

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| é”™è¯¯ç†è§£æ—¶é—´ | 2-5åˆ†é’Ÿï¼ˆæœç´¢+ç†è§£ï¼‰ | 10-30ç§’ï¼ˆç›´æ¥é˜…è¯»ï¼‰ | 75%+ |
| é—®é¢˜å®šä½æ—¶é—´ | 10-30åˆ†é’Ÿï¼ˆæœç´¢æ—¥å¿—+åˆ†æï¼‰ | 2-5åˆ†é’Ÿï¼ˆé”™è¯¯ç ç›´è¾¾ï¼‰ | 80%+ |
| è¶‹åŠ¿åˆ†æèƒ½åŠ› | å›°éš¾ï¼ˆéœ€æ‰‹åŠ¨ç»Ÿè®¡ï¼‰ | ç®€å•ï¼ˆä¸€æ¡æŸ¥è¯¢ï¼‰ | è´¨çš„é£è·ƒ |

### ç¤ºä¾‹å¯¹æ¯”

#### æ”¹è¿›å‰
```javascript
// æ—¥å¿—
logger.warn('Chunk count abnormal', { count: 150 });

// å¼€å‘è€…æ’æŸ¥æµç¨‹
1. æœç´¢æ—¥å¿—ï¼š"abnormal" â†’ æ‰¾åˆ°æ—¥å¿—
2. ç†è§£å«ä¹‰ï¼šä»€ä¹ˆæ˜¯ abnormalï¼Ÿå¤šå°‘ç®— abnormalï¼Ÿ
3. å®šä½ä»£ç ï¼šæœç´¢ "Chunk count abnormal" â†’ æ‰¾åˆ°æ–‡ä»¶å’Œå‡½æ•°
4. åˆ†æé—®é¢˜ï¼šè¯»ä»£ç ç†è§£é€»è¾‘
5. åˆ¤æ–­ä¸¥é‡æ€§ï¼šæ˜¯å¦éœ€è¦å¤„ç†ï¼Ÿ

// æ€»è€—æ—¶ï¼š10-20åˆ†é’Ÿ
```

#### æ”¹è¿›å
```json
{
  "errorCode": "CHUNK_SIZE_ABNORMAL",
  "message": "åˆ†å—æ•°é‡å¼‚å¸¸(150ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡",
  "severity": 2,
  "operation": "intelligentChunkText",
  "context": {
    "chunkCount": 150,
    "textLength": 12000,
    "averageSize": 80
  }
}
```

**å¼€å‘è€…æ’æŸ¥æµç¨‹**ï¼š
1. âœ… çœ‹åˆ°ä¸­æ–‡æ¶ˆæ¯ï¼Œç«‹å³ç†è§£é—®é¢˜
2. âœ… é€šè¿‡ `errorCode` æœç´¢ä»£ç ï¼Œç›´è¾¾ä½ç½®
3. âœ… ä» `context` è·å–å®Œæ•´ä¿¡æ¯ï¼ˆæ–‡æœ¬é•¿åº¦12000ï¼Œåˆ†150å—ï¼Œå¹³å‡80å­—ç¬¦ï¼‰
4. âœ… ä» `severity: 2` åˆ¤æ–­ï¼šä¸­ç­‰ä¸¥é‡åº¦ï¼Œéœ€å…³æ³¨ä½†ä¸ç´§æ€¥

**æ€»è€—æ—¶**ï¼š2-5åˆ†é’Ÿï¼ˆæå‡80%ï¼‰

### ç³»ç»Ÿå¯ç»´æŠ¤æ€§æ”¹è¿›

- âœ… **è¶‹åŠ¿åˆ†æ**ï¼šé€šè¿‡é”™è¯¯ç»Ÿè®¡å‘ç°ç³»ç»Ÿæ€§é—®é¢˜
- âœ… **æ•°æ®é©±åŠ¨**ï¼šæœ‰æ•°æ®æ”¯æŒçš„ä¼˜åŒ–å†³ç­–
- âœ… **çŸ¥è¯†æ²‰æ·€**ï¼šé”™è¯¯ç æˆä¸ºå›¢é˜Ÿå…±åŒè¯­è¨€

---

## âš ï¸ é£é™©å’Œé™åˆ¶

### æŠ€æœ¯é£é™©

| é£é™© | çº§åˆ« | ç¼“è§£æªæ–½ |
|------|------|----------|
| æ€§èƒ½å½±å“ | ä½ | ä»…å¼‚å¸¸æ—¶è§¦å‘ï¼Œå¼‚æ­¥æ”¶é›† |
| æ•°æ®è†¨èƒ€ | ä½ | æˆªæ–­é•¿å­—æ®µï¼Œé™åˆ¶æ ·æœ¬æ•° |
| è¯¯æŠ¥å‘Šè­¦ | ä¸­ | è§‚å¯ŸæœŸè°ƒä¼˜é˜ˆå€¼ |

### ä¸šåŠ¡é™åˆ¶

- **ç”¨æˆ·æ— æ„ŸçŸ¥**ï¼šé”™è¯¯æ”¶é›†å®Œå…¨åå°è¿›è¡Œ
- **åŠŸèƒ½ä¸å—å½±å“**ï¼šç¿»è¯‘ç»“æœå’Œæµç¨‹ä¸å˜
- **å¯å›æ»š**ï¼šç§»é™¤ `collectError` è°ƒç”¨å³å¯

### ç»´æŠ¤æˆæœ¬

| é¡¹ç›® | æˆæœ¬ | é¢‘ç‡ |
|------|------|------|
| æ–°å¢é”™è¯¯ç  | 5åˆ†é’Ÿ/ä¸ª | ä½ï¼ˆPhase 0åå¾ˆå°‘ï¼‰ |
| é˜ˆå€¼è°ƒä¼˜ | 10åˆ†é’Ÿ/æ¬¡ | ä½ï¼ˆè§‚å¯ŸæœŸåç¨³å®šï¼‰ |
| æ–‡æ¡£ç»´æŠ¤ | 2åˆ†é’Ÿ/æ¬¡ | ä½ï¼ˆè·Ÿéšé”™è¯¯ç ï¼‰ |

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

### é¡¹ç›®æ–‡ä»¶
- `app/utils/error-messages.server.js` - é”™è¯¯æ¶ˆæ¯å®šä¹‰
- `app/services/error-collector.server.js` - é”™è¯¯æ”¶é›†æœåŠ¡
- `app/services/translation/core.server.js` - ç¿»è¯‘æ ¸å¿ƒé€»è¾‘
- `app/services/link-converter.server.js` - é“¾æ¥è½¬æ¢é€»è¾‘
- `CLAUDE.md` - é¡¹ç›®æ–‡æ¡£
- `TODO.md` - ä»»åŠ¡è·Ÿè¸ª

### æŠ€æœ¯æ¦‚å¿µ
- **ErrorCollector**: ç»Ÿä¸€é”™è¯¯æ”¶é›†å’Œç®¡ç†ç³»ç»Ÿ
- **Sequential Thinking**: æ™ºèƒ½å†³ç­–å¼•æ“
- **Marketsé…ç½®**: Shopifyå¤šè¯­è¨€åŸŸåæ˜ å°„
- **æ™ºèƒ½åˆ†å—**: é•¿æ–‡æœ¬è‡ªé€‚åº”åˆ†å‰²ç®—æ³•

---

## ğŸ“š é™„å½•

### A. é”™è¯¯æ¶ˆæ¯å®Œæ•´å®šä¹‰

```javascript
// app/utils/error-messages.server.js
const ERROR_MESSAGES = {
  // ... ç°æœ‰æ¶ˆæ¯ ...

  CHUNK_SIZE_ABNORMAL: {
    'zh-CN': 'åˆ†å—æ•°é‡å¼‚å¸¸({chunks}ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡',
    'en': 'Abnormal chunk count ({chunks}), may affect translation quality'
  },

  LINK_CONVERSION_LOW_SUCCESS_RATE: {
    'zh-CN': 'URLè½¬æ¢æˆåŠŸç‡è¿‡ä½',
    'en': 'Link conversion success rate too low'
  }
};
```

### B. é”™è¯¯æ”¶é›†ç¤ºä¾‹

```javascript
// åˆ†å—å¼‚å¸¸
await collectError({
  errorType: ERROR_TYPES.TRANSLATION,
  errorCategory: 'WARNING',
  errorCode: 'CHUNK_SIZE_ABNORMAL',
  message: 'åˆ†å—æ•°é‡å¼‚å¸¸(150ä¸ª)ï¼Œå¯èƒ½å½±å“ç¿»è¯‘è´¨é‡',
  context: {
    chunkCount: 150,
    textLength: 12000,
    averageSize: 80,
    isHtml: true
  },
  operation: 'intelligentChunkText',
  severity: 2
});

// URLè½¬æ¢æˆåŠŸç‡ä½
await collectError({
  errorType: ERROR_TYPES.TRANSLATION,
  errorCategory: 'WARNING',
  errorCode: 'LINK_CONVERSION_LOW_SUCCESS_RATE',
  message: 'URLè½¬æ¢æˆåŠŸç‡è¿‡ä½',
  context: {
    targetLocale: 'pt',
    stats: {
      total: 12,
      success: 8,
      failed: 4,
      rate: "66.7"
    },
    failedSamples: [
      { url: "/products/test...", error: "Target config missing" }
    ]
  },
  operation: 'convertLinksForLocale',
  severity: 2
});
```

### C. æŸ¥è¯¢å‘½ä»¤é€ŸæŸ¥

```bash
# APIæŸ¥è¯¢
curl "/api/errors?errorCode=CHUNK_SIZE_ABNORMAL" | jq .
curl "/api/errors?isTranslationError=true&severity=2" | jq .

# æ—¥å¿—æŸ¥è¯¢
tail -f logs/app.log | jq 'select(.errorCode)'
tail -100 logs/app.log | jq -r '.errorCode' | sort | uniq -c

# ç»Ÿè®¡åˆ†æ
jq 'select(.errorCode == "CHUNK_SIZE_ABNORMAL")' logs/app.log | \
  jq -s 'group_by(.context.chunkCount) | map({chunks: .[0].context.chunkCount, count: length})'
```

---

## ğŸ¬ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆPhase 0ï¼‰
1. âœ… åˆ›å»ºæœ¬éœ€æ±‚æ–‡æ¡£
2. â³ æ›´æ–° TODO.md
3. â³ å®æ–½ä»£ç ä¿®æ”¹ï¼ˆ4ä¸ªæ–‡ä»¶ï¼Œ~90è¡Œï¼‰
4. â³ è¿è¡Œä»£ç æ£€æŸ¥éªŒè¯

### çŸ­æœŸè§‚å¯Ÿï¼ˆ1-2å‘¨ï¼‰
1. ç›‘æ§ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
2. æ”¶é›†é”™è¯¯ç»Ÿè®¡æ•°æ®
3. è¯„ä¼°é˜ˆå€¼åˆç†æ€§
4. æ”¶é›†å›¢é˜Ÿåé¦ˆ

### ä¸­æœŸå†³ç­–ï¼ˆè§‚å¯ŸæœŸåï¼‰
1. åˆ†æ Phase 0 æ•ˆæœ
2. å†³å®šæ˜¯å¦è¿›å…¥ Phase 1
3. è§„åˆ’æ‰©å±•æ–¹å‘
4. è°ƒæ•´ä¼˜åŒ–ç­–ç•¥

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AI Assistant
**æœ€åå®¡æ ¸**: 2025-10-01
**ä¸‹æ¬¡å®¡æ ¸**: Phase 0 å®Œæˆå
